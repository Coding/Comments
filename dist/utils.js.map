{"version":3,"sources":["../src/utils.js"],"names":["getTargetContainer","isString","toString","call","s","container","targetContainer","Element","document","getElementById","createElement","Query","parse","search","window","location","queryString","substring","query","split","forEach","queryStr","key","value","stringify","prefix","Object","keys","map","encodeURIComponent","join","ajaxFactory","method","apiPath","data","base","req","XMLHttpRequest","token","localStorage","getItem","url","startsWith","body","p","Promise","resolve","reject","addEventListener","contentType","getResponseHeader","res","responseText","test","JSON","msg","Error","code","undefined","error","open","setRequestHeader","send","http","get","post","delete","put"],"mappings":"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","file":"utils.js","sourcesContent":["import { \n  LS_ACCESS_TOKEN_KEY,\n  CODING_URL,\n} from './constants'\n\nexport const isString = s => toString.call(s) === '[object String]'\n\nexport function getTargetContainer(container) {\n  let targetContainer\n  if (container instanceof Element) {\n    targetContainer = container\n  } else if (isString(container)) {\n    targetContainer = document.getElementById(container)\n  } else {\n    targetContainer = document.createElement('div')\n  }\n\n  return targetContainer\n}\n\nexport const Query = {\n  parse(search = window.location.search) {\n    if (!search) return {}\n    const queryString = search[0] === '?' ? search.substring(1) : search\n    const query = {}\n    queryString.split('&')\n      .forEach(queryStr => {\n        const [key, value] = queryStr.split('=')\n        if (key) query[key] = value\n      })\n\n    return query\n  },\n  stringify(query, prefix = '?') {\n    const queryString = Object.keys(query)\n      .map(key => `${key}=${encodeURIComponent(query[key] || '')}`)\n      .join('&')\n    return queryString ? prefix + queryString : ''\n  },\n}\n\nfunction ajaxFactory(method) {\n  return function(apiPath, data = {}, base = CODING_URL.base) {\n    const req = new XMLHttpRequest()\n    const token = localStorage.getItem(LS_ACCESS_TOKEN_KEY)\n\n    let url = apiPath;\n    if (!url.startsWith('https://') && !url.startsWith('http://')) {\n        url = `${base}${url}`\n    }\n    let body = null\n    if (method === 'GET' || method === 'DELETE') {\n      url += Query.stringify(data)\n    }\n\n    const p = new Promise((resolve, reject) => {\n      req.addEventListener('load', () => {\n        const contentType = req.getResponseHeader('content-type')\n        const res = req.responseText\n        if (!/json/.test(contentType)) {\n          resolve(res)\n          return\n        }\n        const data = req.responseText ? JSON.parse(res) : {}\n        if (data.msg ) {\n          reject(new Error(JSON.stringify(data.msg)))\n        } else {\n          if (data.code !== undefined) {\n              if (data.code) {\n                  reject(new Error(JSON.stringify(data.code)))\n              } else {\n                  resolve(data.data)\n              }\n          } else {\n              resolve(data)\n          }\n        }\n      })\n      req.addEventListener('error', error => reject(error))\n    })\n    req.open(method, url, true)\n\n    req.setRequestHeader('Accept', 'application/vnd.github.squirrel-girl-preview, application/vnd.github.html+json, application/json')\n    if (!url.startsWith('https://api.github.com')) {\n        req.setRequestHeader('X-API-Version', 'v2')\n        if (token) {\n            req.setRequestHeader('Authorization', `access_token ${token}`)\n        }\n    }\n    if (method !== 'GET') {\n      body = JSON.stringify(data)\n      req.setRequestHeader('Content-Type', 'application/json')\n    }\n\n    req.send(body)\n    return p\n  }\n}\n\nexport const http = {\n  get: ajaxFactory('GET'),\n  post: ajaxFactory('POST'),\n  delete: ajaxFactory('DELETE'),\n  put: ajaxFactory('PUT'),\n}\n"]}